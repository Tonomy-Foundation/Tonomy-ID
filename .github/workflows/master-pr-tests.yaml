name: Test - Master branch PR

on:
  pull_request:
    branches:
      - master
      # triggers when a PR with target to master is opened
      
jobs:
  check-sdk-version:
      runs-on: ubuntu-20.04

      steps:
          - name: 🏗 Setup repo
            uses: actions/checkout@v3

          - name: 📦 Check it is using the latest version of the SDK
            uses: actions/setup-node@v3
            with:
                node-version: 18.12.1
          - run: corepack enable
          - run: echo "PACKAGE_LOCK_SHA256_OLD=$(sha256sum package-lock.json)" >> $GITHUB_ENV
          - run: npm update @tonomy/tonomy-id-sdk
          - run: echo "PACKAGE_LOCK_SHA256_NEW=$(sha256sum package-lock.json)" >> $GITHUB_ENV
          - run: if [ "$PACKAGE_LOCK_SHA256_NEW" != "$PACKAGE_LOCK_SHA256_OLD" ]; then exit 1; fi
          # if this step fails, make sure the Tonomy SDK is set to the latest package
          # try `npm update @tonomy/tonomy-id-sdk` and
          # then test locally, if it works, then commit changes to package.json and package-lock.json