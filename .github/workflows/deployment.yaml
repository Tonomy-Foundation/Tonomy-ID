name: Tonomy ID Continuous Deployment

on:
    push
        # branches:
        #     - '*'
        #     - development

jobs:
    deploy:
        runs-on: ubuntu-20.04
        env:
          NODE_ENV: staging
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          GOOGLE_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}

        steps:
            - name: 🏗 Setup repo
              uses: actions/checkout@v3

            - name: 📦 Install
              uses: actions/setup-node@v3
              with:
                  node-version: 16.4.1
            - run: npm install

            - name: 🚀 Build and publish app
              uses: actions/setup-node@v3
              with:
                  node-version: 16.4.1
            - run: echo "${GOOGLE_SERVICE_ACCOUNT_KEY}" > ./google-service-key.json
            - run: npm run deploy:android
