name: Tonomy ID Continuous Deployment

on:
    push
        # branches:
        #     - '*'
        #     - development

jobs:
    deploy:
        runs-on: ubuntu-20.04
        env:
          NODE_ENV: staging
          TEST: ${{ secrets.TEST }}

        steps:
            - name: 🏗 Setup repo
              uses: actions/checkout@v3

            # - name: 📦 Install
            #   uses: actions/setup-node@v3
            #   with:
            #       node-version: 16.4.1
            # - run: npm install

            # # https://github.com/expo/expo-github-action
            # - name: 🏗 Setup Expo
            #   uses: expo/expo-github-action@v7
            #   with:
            #     expo-version: 47.0.0
            #     expo-cache: false
            #     eas-version: 3.1.0
            #     eas-cache: false
            #     packager: npm
            #     token: ${{ secrets.EXPO_TOKEN }}

            - name: 🚀 Build and publish app
              uses: actions/setup-node@v3
              with:
                  node-version: 16.4.1
              env:
                NODE_ENV: staging
                EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
                TEST: ${{ secrets.TEST }}
                SUPER_SECRET: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
            # - run: echo "${GOOGLE_SERVICE_ACCOUNT_KEY}" > ./google-service-key.json
            - run: ls
            - run: echo "${TEST} -- $TEST -- ${{ env.TEST }}"
            - run: echo "${NODE_ENV} -- $NODE_ENV -- ${{ env.NODE_ENV }}"
            - run: NODE_ENV=staging && npm run deploy:android
